import context.ContextService;
import data.CsvDataService;
import data.DataService;
import user.FileUserService;
import user.UserService;
import ui.Login;
import ui.Main;

import javax.swing.*;

//TIP To <b>Run</b> code, press <shortcut actionId="Run"/> or
// click the <icon src="AllIcons.Actions.Execute"/> icon in the gutter.
public class App {
    public static void main(String[] args) {

        DataService ds = new CsvDataService("peliculas.csv");
        UserService us = new FileUserService("src/main/resources/usuarios.csv");

        // Crear un frame invisible solo para el di치logo de login
        JFrame tempFrame = new JFrame();
        tempFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        // Mostrar login modal al iniciar
        Login loginDialog = new Login(tempFrame, us);
        loginDialog.setVisible(true);

        // Verificar si el usuario se autentic칩 correctamente
        ContextService.getInstance().getItem("usuarioActivo").ifPresentOrElse(
            (usuario) -> {
                tempFrame.dispose();
                // Si el login fue exitoso, abrir la ventana principal
                (new Main(ds, us)).start();
            },
            () -> {
                // Si no se autentic칩, cerrar la aplicaci칩n
                System.exit(0);
            }
        );
    }
}